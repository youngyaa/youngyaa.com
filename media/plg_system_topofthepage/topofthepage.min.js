function highZ(e,t){t=t||Infinity;e=e||document.body;var n,r,i=1,s=[],o=0;var u=e.childNodes,a=u.length;while(o<a){n=u[o++];if(n.nodeType!==1)continue;if(deepCss(n,"position")!=="static"){r=deepCss(n,"z-index");if(r==="auto"){r=highZ(n)}else{r=parseInt(r,10)||0}}else{r=highZ(n)}if(r>i&&r<=t)i=r}return i}function deepCss(e,t){var n,r,i=document.defaultView||window;if(e.nodeType===1){n=t.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()});r=e.style[n];if(!r){if(e.currentStyle)r=e.currentStyle[n];else if(i.getComputedStyle){r=i.getComputedStyle(e,"").getPropertyValue(t)}}}return r||""}var plg_system_topofthepage_class=new Class({Implements:[Options],options:{buttontext:false,topalways:false,styles:false,spyposition:200,visibleopacity:1,smoothscroll:true,slidein:0,slideindir:"bottom",slider:false,zindex:0},initialize:function(e){var t=this;e.visibleopacity=e.visibleopacity<=100&&e.visibleopacity>0?e.visibleopacity/100:1;t.setOptions(e);if(e.topalways)window.scrollTo(0,0);if(t.options.zindex>0){t.options.zindex=highZ(document.body)+1}t.createButton();t.scrollSpy();t.smoothScroll()},createButton:function(){var e=this;if(e.options.styles.left==="center"){Object.erase(e.options.styles,"left");var t=true}if(e.options.zindex>0)e.options.styles["z-index"]=e.options.zindex;var n="#topofthepage";var r=$$("base");if(r.length){var i=new URI(r[0].getAttribute("href"));i.set("fragment","topofthepage");n=i.toURI()}var s=new URI(window.location);if(s.get("query").length){s.set("fragment","topofthepage");n=s.toURI()}var o=(new Element("a",{id:"gototop",href:n.toString(),styles:e.options.styles,rel:"noindex,nofollow"})).inject(document.body,"bottom");if(e.options.icon!==false){var u=(new Element("span",{"class":e.options.icon})).inject(o,"bottom")}if(e.options.buttontext!==false){if(e.options.icon!==false)o.appendText(" ","bottom");o.appendText(e.options.buttontext,"bottom")}if(t){var a=window.getScrollSize().x/2;var f=o.measure(function(){return this.getSize()});o.setStyle("left",a-f.x/2)}},scrollSpy:function(){var e=this;var t=new Fx.Morph("gototop",{duration:e.options.displaydur,transition:"linear"});var n={opacity:[0,e.options.visibleopacity]};var r={opacity:[e.options.visibleopacity,0]};if(parseInt(e.options.slidein)){var i=0;switch(e.options.slideindir){case"top":i=document.id("gototop").getSize().y;property="margin-bottom";break;case"bottom":i=document.id("gototop").getSize().y;property="margin-top";break;case"left":i=document.id("gototop").getSize().x;property="margin-right";break;case"right":i=document.id("gototop").getSize().x;property="margin-left";break}var s=document.id("gototop").getStyle(property);var o=parseInt(s.replace("px",""))+i;n[property]=[o+"px",s];r[property]=[s,o+"px"]}var u=new ScrollSpy({min:e.options.spyposition,container:window,onEnter:function(e,r){t.start(n)},onLeave:function(e,n){t.start(r)}})},smoothScroll:function(){var e=this;var t=new Fx.Scroll(document.body,e.options.smoothscroll);document.id("gototop").addEvent("click",function(){t.toTop();return false})}});window.addEvent("domready",function(){var e=new plg_system_topofthepage_class(window.plg_system_topofthepage_options)})